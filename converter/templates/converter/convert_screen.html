{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Cow</title>
  <link rel="stylesheet" href="{% static 'converter/styles.css' %}">
  <link rel="icon" href="{% static 'converter/cow.ico' %}" type="image/x-icon">
</head>
<body>
  <!-- Header Bar -->
  <div class="header">
      <button class="hamburger" id="hamburger">
          <span></span>
          <span></span>
          <span></span>
      </button>
      <div class="app-title">Smart Cow Web</div>
  </div>

  <!-- Navigation Bar -->
  <div class="navigation-side-bar" id="navigation-side-bar">
    <div class="menu-title-element">
      <p class="menu-title-text"> Navigation </p>
    </div>
    <div class="menu-content-container">

      <div class="menu-section-container">
        <p class="menu-section-title">DATA</p>

        <button class="menu-section-element" onclick="window.location.href='{% url 'welcome' %}'">
            <span class="nav-button-icon">üìÅ</span>
            <span class="nav-button-text">Load Dataset</span>
        </button>

        <button class="menu-section-element"  onclick="triggerNQuadsConversion()">
          <span class="nav-button-icon"> üíæ</span> 
          <span class="nav-button-text">Export Data</span>
        </button>

        <button class="menu-section-element" id="nav-vocabulary-manager-button">
          <span class="nav-button-icon">üìù</span> 
          <span class="nav-button-text">Vocabulary Manager</span>
        </button>

        <div class="menu-separator"></div>
      </div>

      <div class="menu-section-container">
        <p class="menu-section-title">TOOLS</p>

        <button class="menu-section-element">
          <span class="nav-button-icon">‚öôÔ∏è</span> 
          <span class="nav-button-text">Configure Endpoint</span>
        </button>

        <button class="menu-section-element" id="nav-search-button">
          <span class="nav-button-icon">üîç</span>
          <span class="nav-button-text">Search</span>
        </button>

        <button class="menu-section-element" id="colorblind-button" aria-pressed="false">
          <span class="nav-button-icon">üëÅÔ∏è</span> 
          <span class="nav-button-text">Color Blind mode</span>
        </button>

        <div class="menu-separator"></div>
      </div>

      <div class="menu-section-container">
        <p class="menu-section-title">HELP</p>

        <button class="menu-section-element" id="documentation-button">
            <span class="nav-button-icon">üìö</span> 
            <span class="nav-button-text"> Documentation (Dev)</span>
        </button>

        <button class="menu-section-element" id="support-button">
          <span class="nav-button-icon">üí¨</span> 
          <span class="nav-button-text">Support</span>
        </button>

        <button class="menu-section-element" id="about-button">
          <span class="nav-button-icon">‚ÑπÔ∏è</span> 
          <span class="nav-button-text">About</span>
        </button>

        <div class="menu-separator"></div>
      </div>
    </div>
  </div>

  <div class="main-overlay", id="main-overlay"></div>

  <!-- Vocabulary Manager Popup (give vocabularies priority) -->
  <div class="vocabulary-manager-helper-popup" id="vocabulary-manager-helper-popup">
    <div class="vocabulary-manager-popup-content">
      <div class="helper-popup-header-vocabulary-manager">
        <h2 class="helper-popup-title-vocabulary">Vocabulary Manager</h2>
        <button class="match-close-vocabulary-manager" onclick="closeHelperPopup('matchContainer')">x</button>
      </div>
      <hr class="solid-separator-popup">
      <div class="vocabulary-manager-helper-popup-body">
        <p class="vocabulary-manager-description">Set the priority order for vocabulary recommendations. Reorder using controls below.</p>
        <div class="vocabulary-manager-input-field">
          <input type="text" id="input-vocabulary-manager" placeholder="Enter vocabulary name" class="input-vocabulary-manager" />
          <button class="add-vocabulary-manager" id="add-vocabulary-manager">Add</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Nav Search Helper Popup (quick search from navbar) -->
  <div class="helper-popup" id="nav-search-helper">
    <div class="helper-popup-content">
      <div class="helper-popup-header">
        <h2 class="helper-popup-title">Quick Search</h2>
      </div>
      <div class="helper-popup-body">
        <input type="text" id="nav-header-search" placeholder="Enter header name" class="header-search" />
        <div style="margin-top:12px;">
          <button class="search-button" id="nav-search-submit">Show Matches</button>
          <button class="close-button" onclick="closeHelperPopup('nav-search-helper')">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Support Form Popup -->
  <div class="helper-popup" id="support-form-popup">
    <div class="helper-popup-content">
      <div class="helper-popup-header">
        <h2 class="helper-popup-title">Support Request</h2>
      </div>
      <div class="helper-popup-body">
        <form method="POST" action="{% url 'submit_support' %}" class="support-form">
          {% csrf_token %}
          <div class="form-group">
            <input type="text" name="title" placeholder="Title" required class="support-input">
          </div>
          <div class="form-group">
            <textarea name="message" placeholder="Your message" required class="support-textarea"></textarea>
          </div>
          <div class="form-group">
            <input type="email" name="contact" placeholder="Contact email (optional)" class="support-input">
          </div>
          <div style="margin-top:12px;">
            <button type="submit" class="search-button">Submit</button>
            <button type="button" class="close-button" onclick="closeHelperPopup('support-form-popup')">Close</button>
          </div>
        </form>
      </div>
    </div>
  </div>


  <div class="converter-container">
    
    <!-- Full Dataset Popup Window-->
    <div class="popup" id="dataset_popup">
      <div class="dataset_content">
        <div class="popup-header">
          <h2 class="popup-title">Full Dataset</h2>
        </div>
        <table class="csv-table">
          <thead>
            <tr>
              {% for header in headers %}
                <th>{{ header }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for row in full_table %}
              <tr>
                {% for cell in row %}
                  <td>{{ cell }}</td>
                {% endfor %}
              </tr>
            {% endfor %}
          </tbody>
        </table>
        <button class="close-button" onclick="closeDatasetForm()">Close</button>
      </div>
    </div>
    <!-- End Of Full Datase Popup Window-->

    <!-- HELPER POPUPS-->
    <!-- Request Type Popup-->
    <div class="helper-popup" id="request-type-helper"> 
      <div class="helper-popup-content">
        <div class="helper-popup-header">
          <h2 class="helper-popup-title" id="helper_title">Request Type</h2>
        </div>
        <div class="helper-popup-body" id="helper_body">
          <p><strong>Single:</strong> Returns the best vocabulary suggestion for each column independently.</p>
          <p><strong>Homogenous:</strong> Finds a single vocabulary that works well for all columns together.</p>
        </div>
        <button class="close-button" onclick="closeHelperPopup('request-type-helper')">Close</button>
      </div>
    </div>

    <!-- Vocabulary Recommender Helper Popup -->
    <div class="helper-popup" id="vocabulary-recommender-helper"> 
      <div class="helper-popup-content">
        <div class="helper-popup-header">
          <h2 class="helper-popup-title">Vocabulary Recommendations</h2>
        </div>
        <div class="helper-popup-body">
          <p>Each card represents a column from your uploaded CSV file. It shows the column name, its detected data type, and how many unique values it contains. Use the 'Show Matches' button to view vocabulary suggestions tailored for that specific column.</p>
        </div>
        <button class="close-button" onclick="closeHelperPopup('vocabulary-recommender-helper')">Close</button>
      </div>
    </div>
    

    {{ all_matches|json_script:"all-matches-data" }}
    {{ vocab_coverage_score|json_script:"vocab-coverage-score-data" }}
    {{ sorted_vocabs|json_script:"sorted-vocabs-data" }}
    {{ best_match_index|json_script:"best-match-index-data" }}
    {{ headers|json_script:"headers" }}
    {{ vocabulary_data|json_script:"vocabulary-data" }}

    <!-- Resizable match window -->
    <div class="match-container" id="matchContainer">
      <div class="match-resizer" id="matchResizer">...</div>
      <div class="match-header" id="matchHeader">
        <h2 class="match-header-text" id="match-header-text">Matches</h2>
        <button class="match-close" onclick="closeHelperPopup('matchContainer')">x</button>
      </div>
      <div class="match-content" id="match-content">
        <div class="best-match-table" id="best-match-table">
          <h2 class="he1"> Best Match</h2>
          <table class="match-table" id="best-match-table-element"></table>
        </div>
        <div class="all-match-table">
          <h2 class="he1"> All Matches</h2>
          <table class="match-table" id="match-table"></table>
        </div>
      </div>
    </div>

    <div class="insert-popup" id="insert-popup">
      <div class="insert-popup-content">
        <h2>Select Action</h2>
        <div class="insert-popup-buttons">
          <form method="POST" class="insert-match-form" action="{% url 'insert_match' %}">
            {% csrf_token %}
            <button class="insert-btn" id="insert-btn">Insert</button>
          </form>
          <button class="source-btn" id="source-btn">Source</button>
          <button class="cancel-btn" id="cancel-btn" onclick="closeHelperPopup('insert-popup')">Cancel</button>
        </div>
      </div>
    </div>
    <!-- MAIN CONTENT DIVIDED IN 3 SECTIONS-->

    <!-- LEFT: CSV Preview -->
    <section class="panel panel-left">
      <h2 class="panel-title">CSV Preview</h2>
      
      <!-- Dynamically initialize the csv table preview -->
      <table class="csv-table">
        <thead>
          <tr>
            {% for header in headers %}
              <th>{{ header }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in rows %}
            <tr>
              {% for cell in row %}
                <td>{{ cell }}</td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    
      <button type="button" class="load-button" onclick="openDatasetForm()">Load Full Dataset</button>
  
    </section>

    <!-- MIDDLE: Vocabulary Recommender -->
    <section class="panel panel-middle">

      <h2 class="panel-title">Vocabulary Recommender</h2>

      <!-- Upper subtitle with the helper button -->
      <hr class="solid-separator">
      <div class="request-type-separator">
        <p class="sub-title">Choose Request type</p>
        <button class="helper-button" onclick="openHelperPopup('request-type-helper')">?</button>
      </div>
      <hr class="solid-separator">

      <!-- Request type section -->
      <div class="request-type-container">

        <!-- Request Type buttons: Form(Button)-->
        <form method="POST" class='request-type-form' action="{% url 'set_request_type' 'Homogenous' %}">
          {% csrf_token %}
          <button class="request-type-button {% if request_type == 'Homogenous' %}active{% endif %}" id="homogenous-button">Homogenous</button>
        </form>
        <form method="POST" class="request-type-form"action="{% url 'set_request_type' 'Single' %}">
          {% csrf_token %}
          <button class="request-type-button {% if request_type == 'Single' %}active{% endif %}" id="single-button">Single</button>
        </form>

      </div>
      <div class="replace-all-container">

        <form method="POST" class='request-type-form' action="{% url 'replace_all' %}">
          {% csrf_token %}
          <button class="replace-all-button">Replace All</button>
        </form>
        
      </div>

      <!-- Bottom subtitle with the helper button -->
      <hr class="solid-separator">
      <div class="request-type-separator">
        <p class="sub-title">Vocabulary Recommender Results</p>
        <button class="helper-button" onclick="openHelperPopup('vocabulary-recommender-helper')">?</button>
      </div>
      <hr class="solid-separator">

      <div class="search-block">
        <input type="text" class="header-search" id="header-search" placeholder="Enter header name">
        <button class="search-button" id="search-button">Show Matches</button>
      </div>

      <!-- Card Section -->
      <div class="card-container">

        <!-- Vocabulary Scores Card -->
        <div class="card">
          <h4><strong>Vocabulary Scores</strong></h4>
          <p>Vocabularies: </p>
          <button class="card-button" id='vocab-card-button'>Show Scores</button>
        </div>
      
        <!-- Header Cards -->
        {% for header in headers %}
          <div class="card">
            <p><strong>Header:</strong> {{ header }}</p>
            {% for key, value in matches_count.items %}
              {% if key == header %}
                <p>Type: {{ header }}  |  Matches: {{ value }} </p>
              {% endif %}
            {% endfor %}
            <button class="card-button" id="card-button" data-header="{{ header }}">Show Matches</button>
          </div>
        {% endfor %}
      
      </div>

    </section>

    <!-- RIGHT: JSON Preview -->
    <section class="panel panel-right">

      <h2 class="panel-title">JSON Preview</h2>

      <!-- JSON text editing area -->
      <div class="json-preview-container">
        <form method="POST" class='save-file-form' action="{% url 'save_file' %}">
          {% csrf_token %}
          
          <textarea name="json_text" class="json-textarea" id="jsonPreview" placeholder="JSON content will appear here...">{{ json_content }}</textarea>

          <!-- Buttons to save and convert -->
          <div class="json-buttons">
              <button class="json-button save-button" type="submit">Save</button>
            </form>
            <button class="json-button convert-button" onclick="triggerNQuadsConversion()">Convert</button>
          </div>

        </form>
      </div>

    </section>

  </div>

  <script src="{% static 'converter/main.js' %}"></script>
</body>
</html>
